C51 COMPILER V9.54   MAIN                                                                  05/21/2023 10:07:21 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil5 C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "reg52.h"
   2          
   3          
   4          sbit S1 = P3^2;
   5          sbit S2 = P3^3;
   6          
   7          sbit L1 = P2^0;
   8          sbit L2 = P2^1;
   9          sbit L3 = P2^2;
  10          sbit L4 = P2^3;
  11          sbit L5 = P2^4;
  12          sbit L6 = P2^5;
  13          sbit L7 = P2^6;
  14          sbit L8 = P2^7;
  15          
  16          sbit P1_0 = P1^0;
  17          sbit P1_1 = P1^1;
  18          sbit P1_2 = P1^2;
  19          sbit P1_3 = P1^3;
  20          
  21          unsigned int timer0_cnt = 0;
  22          unsigned int key_cnt = 0;
  23          char a[8] = {0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};
  24          char seg[10] = {0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};
  25          
  26          char Flag_1 = 0; 
  27          char Flag_2 = 0;
  28          void Key_scan()
  29          {
  30   1      
  31   1        if(S1 == 0)
  32   1        {
  33   2          Flag_1 = 1;
  34   2        }
  35   1        if(Flag_1 == 1 && S1 == 1)
  36   1        {
  37   2          Flag_1 = 0;
  38   2      //    key_cnt += 1;
  39   2          L1 = 0;
  40   2          L2 = 1;
  41   2        }
  42   1        
  43   1        if(S2 == 0)
  44   1        {
  45   2          Flag_2 = 1;
  46   2        }
  47   1        if(Flag_2 == 1 && S1 == 1)
  48   1        {
  49   2          Flag_2 = 0;
  50   2      //    key_cnt -= 1;
  51   2          L2 =0;
  52   2          L1 =1;
  53   2        }
  54   1      }
  55          
C51 COMPILER V9.54   MAIN                                                                  05/21/2023 10:07:21 PAGE 2   

  56          void delay_ms(int ms)
  57          {
  58   1          int i = 0;
  59   1          int j = 0;
  60   1          for(i=0;i<ms;i++)
  61   1          {
  62   2              for(j=0;j<100;j++){}
  63   2          }
  64   1      }
  65          
  66          
  67          
  68          
  69          void SMG_pos(unsigned char i)
  70          {
  71   1        switch(i)
  72   1        {
  73   2          case 1:
  74   2            P1_0 = 1;
  75   2            P1_1 = 0;
  76   2            P1_2 = 0;
  77   2            P1_3 = 0;
  78   2          break;
  79   2          
  80   2          case 2:
  81   2            P1_0 = 0;
  82   2            P1_1 = 1;
  83   2            P1_2 = 0;
  84   2            P1_3 = 0;
  85   2          break;
  86   2          
  87   2          case 3:
  88   2            P1_0 = 0;
  89   2            P1_1 = 0;
  90   2            P1_2 = 1;
  91   2            P1_3 = 0;
  92   2          break;
  93   2          
  94   2          case 4:
  95   2            P1_0 = 0;
  96   2            P1_1 = 0;
  97   2            P1_2 = 0;
  98   2            P1_3 = 1;
  99   2          break;
 100   2          
 101   2          case 5:
 102   2            P1_0 = 0;
 103   2            P1_1 = 0;
 104   2            P1_2 = 0;
 105   2            P1_3 = 0;
 106   2          break;
 107   2        }
 108   1      }
 109          
 110          void SMG_bit(unsigned char pos,value)
 111          {
 112   1        SMG_pos(pos);
 113   1        P0 = seg[value];
 114   1      }
 115          
 116          
 117          
C51 COMPILER V9.54   MAIN                                                                  05/21/2023 10:07:21 PAGE 3   

 118          void SMG_Dynamic()
 119          {
 120   1        SMG_bit(1,key_cnt/1000);
 121   1      //  delay_ms(10);
 122   1        SMG_bit(2,key_cnt/100%10);
 123   1      //  delay_ms(10);
 124   1        SMG_bit(3,key_cnt/10%10);
 125   1      //  delay_ms(10);
 126   1        SMG_bit(4,key_cnt%10);
 127   1      //  delay_ms(10);
 128   1        SMG_bit(5,0x00);
 129   1      //  delay_ms(10);
 130   1      }
 131          
 132          
 133          void InitTimer0()
 134          {
 135   1        TMOD = 0x01;
 136   1        TH0 = (65535 - 50000) / 256; // 50ms
 137   1        TL0 = (65535 - 50000) % 256;
 138   1        
 139   1        ET0 = 1;
 140   1        EA = 1;
 141   1        TR0 = 1;
 142   1      }
 143          
 144          unsigned char count = 0;
 145          void ServiceTimer0() interrupt 1
 146          {
 147   1        TH0 = (65535 - 50000) / 256;
 148   1        TL0 = (65535 - 50000) % 256;
 149   1        
 150   1        count++;
 151   1        if(count == 20)
 152   1        {
 153   2          count = 0;
 154   2          key_cnt++;
 155   2        }
 156   1      }
 157          
 158          void main()
 159          {
 160   1        InitTimer0();
 161   1        while(1)
 162   1        {
 163   2      //    P2 = a[key_cnt%8];
 164   2      //    Key_scan();
 165   2          SMG_Dynamic();
 166   2        }
 167   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    293    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
